{% extends 'base.html' %}
{% load static %}

{% block title %}Donor Dashboard - MedShare{% endblock %}

{% block content %}
<div style="margin-bottom: 40px;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
        <h1 style="color: var(--dark); margin: 0;">
            <i class="fas fa-heart"></i> My Donations
        </h1>
        <a href="{% url 'add_medicine' %}" class="btn-primary">
            <i class="fas fa-plus"></i> Add New Medicine
        </a>
    </div>

    <!-- Statistics -->
    <div class="dashboard">
        <div class="stat-box">
            <div class="stat-number">{{ total }}</div>
            <div class="stat-label"><i class="fas fa-pills"></i> Total Medicines</div>
        </div>
        <div class="stat-box">
            <div class="stat-number">{{ available }}</div>
            <div class="stat-label"><i class="fas fa-check-circle"></i> Available</div>
        </div>
        <div class="stat-box">
            <div class="stat-number">{{ donated }}</div>
            <div class="stat-label"><i class="fas fa-hands-helping"></i> Donated</div>
        </div>
    </div>
</div>

<!-- Medicines List -->
{% if medicines %}
    <div style="display: grid; grid-template-columns: 1fr; gap: 20px;">
        {% for medicine in medicines %}
        <div class="card app-card">
            <div class="medicine-card">
                {% if medicine.image %}
                    <div class="medicine-image">
                        <img src="{{ medicine.image.url }}" alt="{{ medicine.name }}">
                    </div>
                {% else %}
                    <div class="medicine-image" style="background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); color: white;">
                        <i class="fas fa-pills" style="font-size: 50px;"></i>
                    </div>
                {% endif %}

                <div class="medicine-info">
                    <h3>{{ medicine.name }}</h3>
                    
                    <div class="medicine-meta">
                        <div class="meta-item">
                            <span class="meta-label"><i class="fas fa-cube"></i> Quantity:</span>
                            <span class="meta-value">{{ medicine.quantity }} {{ medicine.unit }}</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label"><i class="fas fa-calendar"></i> Expires:</span>
                            <span class="meta-value">{{ medicine.expiry_date|date:"M d, Y" }}</span>
                            {% if medicine.days_left < 0 %}
                                <span class="expiry-badge expired"><i class="fas fa-exclamation"></i> Expired</span>
                            {% elif medicine.expiring_soon %}
                                <span class="expiry-badge soon"><i class="fas fa-clock"></i> Expires Soon ({{ medicine.days_left }}d)</span>
                            {% endif %}
                        </div>
                    </div>

                    {% if medicine.description %}
                    <p style="color: #666; margin: 10px 0;">{{ medicine.description }}</p>
                    {% endif %}

                    <div style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
                        <span class="badge {% if medicine.status == 'available' %}badge-success{% elif medicine.status == 'donated' %}badge-warning{% else %}badge-danger{% endif %}">
                            <i class="fas fa-info-circle"></i> {{ medicine.get_status_display }}
                        </span>
                        {% if medicine.avg_rating %}
                            <span style="color: #ffc107;">
                                <i class="fas fa-star"></i> {{ medicine.avg_rating|floatformat:1 }}/5 ({{ medicine.ratings_count|default:medicine.rating_count|default:0 }} reviews)
                            </span>
                        {% endif %}
                    </div>

                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <a href="{% url 'medicine_detail' medicine.id %}" class="btn-secondary" style="padding: 8px 16px;">
                            <i class="fas fa-eye"></i> View Details
                        </a>
                        <a href="{% url 'edit_medicine' medicine.id %}" class="btn-secondary" style="padding: 8px 16px;">
                            <i class="fas fa-edit"></i> Edit
                        </a>
                        <form method="POST" action="{% url 'delete_medicine' medicine.id %}" style="margin: 0;">
                            {% csrf_token %}
                            <button type="submit" class="btn-danger" style="padding: 8px 16px;" onclick="return confirm('Delete this medicine? This cannot be undone.');">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
{% else %}
    <div class="card app-card" style="text-align: center; padding: 60px;">
        <i class="fas fa-inbox" style="font-size: 48px; color: #ccc; margin-bottom: 20px;"></i>
        <h3 style="color: #999;">No medicines yet</h3>
        <p style="color: #999; margin-bottom: 20px;">Start by adding medicines you want to donate.</p>
        <a href="{% url 'add_medicine' %}" class="btn-primary">
            <i class="fas fa-plus"></i> Add Medicine
        </a>
    </div>
{% endif %}

{% endblock %}
