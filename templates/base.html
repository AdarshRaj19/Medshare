{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}MedShare - Medicine Donation Platform{% endblock %}</title>
    <link href="http://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Skip to main content link for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Page Loader -->
<div id="page-loader">
    <div class="loader-content">
        <img id="loader-img" src="{% static 'images/heartbeat-animation-gif.gif' %}" alt="Loading" onerror="this.style.display='none'; document.getElementById('loader-spinner').style.display='inline-block';">
        <div id="loader-spinner" class="loader-spinner" style="display:none;" aria-hidden="true"></div>
        <h5>Loading MedShare...</h5>
    </div>
</div>


<!-- NAVBAR -->
<header class="navbar">
    <div class="nav-left">
        <a href="{% url 'home' %}" class="logo">
            <i class="fas fa-leaf"></i> MedShare
        </a>
    </div>

    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle d-md-none" aria-label="Toggle navigation menu">
        <i class="fas fa-bars"></i>
    </button>

    <div class="nav-right">
        {% if user.is_authenticated %}
            <span class="welcome">
                <i class="fas fa-user"></i> Hi, {{ user.first_name|default:user.username }}!
            </span>

            {% if user.is_superuser %}
                <a href="{% url 'admin_reports' %}" title="Admin Dashboard">
                    <i class="fas fa-chart-line"></i> Reports
                </a>
                <a href="{% url 'admin_delivery_requests' %}" title="Porter Requests">
                    <i class="fas fa-hands-helping"></i> Porter Requests
                </a>
            {% elif user.profile.role == "donor" %}
                <a href="{% url 'donor_dashboard' %}" title="Your Donations">
                    <i class="fas fa-heart"></i> Dashboard
                </a>
                <a href="{% url 'search_medicines' %}" title="Search Medicines">
                    <i class="fas fa-search"></i>
                </a>
            {% elif user.profile.role == "individual" %}
                <a href="{% url 'search_medicines' %}" title="Find Medicines">
                    <i class="fas fa-search"></i> Find
                </a>
            {% elif user.profile.role == "ngo" %}
                <a href="{% url 'ngo_dashboard' %}" title="Find Medicines">
                    <i class="fas fa-search"></i> Find
                </a>
                <a href="{% url 'search_medicines' %}" title="Search Medicines">
                    <i class="fas fa-search"></i>
                </a>
                <a href="{% url 'medicine_categories' %}" title="Medicine Categories">
                    <i class="fas fa-th-large"></i>
                </a>
                <a href="{% url 'medicines_map' %}" title="Medicine Map">
                    <i class="fas fa-map"></i>
                </a>
                <a href="{% url 'emergency_alerts' %}" title="Emergency Alerts">
                    <i class="fas fa-exclamation-triangle"></i>
                </a>
                <a href="{% url 'bulk_requests' %}" title="Bulk Requests">
                    <i class="fas fa-list-check"></i>
                </a>
            {% else %}
                <!-- Other roles: minimal links -->
                <a href="{% url 'search_medicines' %}" title="Search Medicines">
                    <i class="fas fa-search"></i>
                </a>
            {% endif %}

            <a href="{% url 'medicine_chatbot' %}" title="AI Chatbot">
                <i class="fas fa-robot"></i>
            </a>

            <a href="{% url 'messages_list' %}" title="Messages">
                <i class="fas fa-envelope"></i>
                {% if unread_messages_count|default:0 %}
                    <span class="badge badge-danger">{{ unread_messages_count }}</span>
                {% endif %}
            </a>

            <a href="{% url 'notifications' %}" title="Notifications">
                <i class="fas fa-bell"></i>
                {% if unread_notifications_count|default:0 %}
                    <span class="badge badge-danger">{{ unread_notifications_count }}</span>
                {% endif %}
            </a>

            <button id="theme-toggle" class="theme-toggle-btn" title="Toggle Theme" aria-label="Toggle between light and dark mode">
                <i class="fas fa-moon" aria-hidden="true"></i>
            </button>

            <!-- User Profile Dropdown -->
            <div class="nav-user-menu">
                <a href="{% url 'user_profile' %}" class="user-profile-link" title="Profile Settings">
                    {% if user.profile.profile_picture %}
                        <img src="{{ user.profile.profile_picture.url }}" 
                             alt="{{ user.username }}" 
                             class="profile-avatar">
                    {% else %}
                        <div class="profile-avatar-default">
                            <i class="fas fa-user"></i>
                        </div>
                    {% endif %}
                </a>
            </div>

            <a class="btn-outline" href="{% url 'logout' %}">
                <i class="fas fa-sign-out-alt"></i> Logout
            </a>
        {% else %}
            <a href="{% url 'login' %}">
                <i class="fas fa-sign-in-alt"></i> Login
            </a>
            <a class="btn-outline" href="{% url 'signup' %}">
                <i class="fas fa-user-plus"></i> Signup
            </a>
        {% endif %}
    </div>
</header>

<!-- Main Content -->
<main id="main-content" role="main">

<!-- PAGE CONTENT -->
<main class="main-container">
    {% if messages and not suppress_flash_messages %}
        {% for message in messages %}
            <div class="alert alert-{% if message.tags == 'error' %}danger{% else %}{{ message.tags }}{% endif %}">
                <i class="fas fa-info-circle"></i>
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    {% block content %}{% endblock %}
</main>
</main>



<script src="http://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
{% block extra_js %}{% endblock %}

<script>
    // Update current year in footer
    document.addEventListener('DOMContentLoaded', function() {
        const yearElement = document.getElementById('current-year');
        if (yearElement) {
            yearElement.textContent = new Date().getFullYear();
        }
    });

    // Theme Toggle Functionality
    document.addEventListener('DOMContentLoaded', function() {
        const themeToggle = document.getElementById('theme-toggle');
        const html = document.documentElement;
        const icon = themeToggle.querySelector('i');

        // Check for saved theme preference or default to light mode
        const currentTheme = localStorage.getItem('theme') || 'light';
        html.setAttribute('data-theme', currentTheme);

        // Update icon based on current theme
        updateThemeIcon(currentTheme);

        // Toggle theme on button click
        themeToggle.addEventListener('click', function() {
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';

            // Add transition class for smooth animation
            document.body.classList.add('theme-transitioning');

            // Apply new theme
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);

            // Remove transition class after animation
            setTimeout(() => {
                document.body.classList.remove('theme-transitioning');
            }, 300);
        });

        function updateThemeIcon(theme) {
            if (theme === 'dark') {
                icon.className = 'fas fa-sun';
                themeToggle.title = 'Switch to Light Mode';
            } else {
                icon.className = 'fas fa-moon';
                themeToggle.title = 'Switch to Dark Mode';
            }
        }
    });

    // Page Loader
    window.addEventListener("load", function () {
        const loader = document.getElementById("page-loader");
        loader.style.opacity = "0";
        setTimeout(() => loader.style.display = "none", 500);
    });

    // Back to Top Button
    document.addEventListener('DOMContentLoaded', function() {
        const backToTopBtn = document.getElementById('back-to-top');

        // Show/hide button based on scroll position
        window.addEventListener('scroll', function() {
            if (window.pageYOffset > 300) {
                backToTopBtn.classList.add('show');
            } else {
                backToTopBtn.classList.remove('show');
            }
        });

        // Smooth scroll to top
        backToTopBtn.addEventListener('click', function() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });

        // Newsletter form handling
        const newsletterForm = document.querySelector('.newsletter-form');
        if (newsletterForm) {
            newsletterForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const email = this.querySelector('input[type="email"]').value;
                const submitBtn = this.querySelector('button[type="submit"]');
                const originalText = submitBtn.innerHTML;

                if (email) {
                    // Show loading state
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                    submitBtn.disabled = true;

                    // Simulate API call (replace with actual implementation)
                    setTimeout(() => {
                        // Here you would typically send the email to your backend
                        showNotification('Thank you for subscribing! We\'ll keep you updated on medicine donation opportunities.', 'success');
                        this.reset();
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                    }, 1000);
                }
            });
        }

        // Notification system
        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `alert alert-${type} notification-toast`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'info-circle'}"></i>
                ${message}
            `;

            // Add to page
            document.body.appendChild(notification);

            // Show with animation
            setTimeout(() => notification.classList.add('show'), 100);

            // Auto remove after 5 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 5000);
        }

        // Professional Footer Features
        // Animated Counter for Statistics
        function animateCounters() {
            const counters = document.querySelectorAll('.stat-number');
            const speed = 200;

            counters.forEach(counter => {
                const target = parseInt(counter.getAttribute('data-target'));
                const increment = target / speed;
                let current = 0;

                const updateCounter = () => {
                    current += increment;
                    if (current < target) {
                        counter.innerText = Math.floor(current).toLocaleString();
                        setTimeout(updateCounter, 1);
                    } else {
                        counter.innerText = target.toLocaleString();
                    }
                };

                // Start animation when element is in viewport
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            updateCounter();
                            observer.unobserve(entry.target);
                        }
                    });
                }, { threshold: 0.5 });

                observer.observe(counter);
            });
        }

        // Back to Top Button
        function initBackToTop() {
            const backToTopBtn = document.getElementById('back-to-top-professional');

            if (backToTopBtn) {
                // Show/hide button based on scroll position
                window.addEventListener('scroll', () => {
                    if (window.pageYOffset > 300) {
                        backToTopBtn.classList.add('show');
                    } else {
                        backToTopBtn.classList.remove('show');
                    }
                });

                // Smooth scroll to top
                backToTopBtn.addEventListener('click', () => {
                    window.scrollTo({
                        top: 0,
                        behavior: 'smooth'
                    });
                });
            }
        }

        // Mobile Menu Toggle
        function initMobileMenu() {
            const mobileMenuToggle = document.querySelector('.mobile-menu-toggle');
            const navRight = document.querySelector('.nav-right');

            if (mobileMenuToggle && navRight) {
                mobileMenuToggle.addEventListener('click', () => {
                    navRight.classList.toggle('active');
                    mobileMenuToggle.classList.toggle('active');

                    // Close menu when clicking outside
                    const closeMenu = (e) => {
                        if (!navRight.contains(e.target) && !mobileMenuToggle.contains(e.target)) {
                            navRight.classList.remove('active');
                            mobileMenuToggle.classList.remove('active');
                            document.removeEventListener('click', closeMenu);
                        }
                    };

                    if (navRight.classList.contains('active')) {
                        setTimeout(() => document.addEventListener('click', closeMenu), 1);
                    }
                });

                // Close menu on window resize if desktop size
                window.addEventListener('resize', () => {
                    if (window.innerWidth >= 768) {
                        navRight.classList.remove('active');
                        mobileMenuToggle.classList.remove('active');
                    }
                });
            }
        }

        // Newsletter Form Professional
        function initNewsletterForm() {
            const newsletterForm = document.querySelector('.newsletter-form-professional');

            if (newsletterForm) {
                newsletterForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const emailInput = this.querySelector('.newsletter-input');
                    const submitBtn = this.querySelector('.newsletter-btn');
                    const email = emailInput.value.trim();

                    if (email && isValidEmail(email)) {
                        const originalHTML = submitBtn.innerHTML;

                        // Show loading state
                        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                        submitBtn.disabled = true;
                        emailInput.disabled = true;

                        // Simulate API call (replace with actual implementation)
                        setTimeout(() => {
                            showNotification('ðŸŽ‰ Welcome to MedShare! You\'re now subscribed to our newsletter.', 'success');
                            this.reset();
                            submitBtn.innerHTML = originalHTML;
                            submitBtn.disabled = false;
                            emailInput.disabled = false;

                            // Add success animation
                            submitBtn.style.transform = 'scale(1.05)';
                            setTimeout(() => {
                                submitBtn.style.transform = '';
                            }, 200);
                        }, 1500);
                    } else {
                        showNotification('Please enter a valid email address.', 'danger');
                        emailInput.focus();
                    }
                });
            }
        }

        // Email validation helper
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // Social Media Links Hover Effects
        function initSocialLinks() {
            const socialLinks = document.querySelectorAll('.social-link-pro');

            socialLinks.forEach(link => {
                link.addEventListener('mouseenter', function() {
                    const tooltip = this.querySelector('.social-tooltip');
                    if (tooltip) {
                        tooltip.style.opacity = '1';
                        tooltip.style.visibility = 'visible';
                        tooltip.style.transform = 'translateX(-50%) translateY(-5px)';
                    }
                });

                link.addEventListener('mouseleave', function() {
                    const tooltip = this.querySelector('.social-tooltip');
                    if (tooltip) {
                        tooltip.style.opacity = '0';
                        tooltip.style.visibility = 'hidden';
                        tooltip.style.transform = 'translateX(-50%)';
                    }
                });
            });
        }

        // Footer CTA Button Animation
        function initCTAButton() {
            const ctaButton = document.querySelector('.cta-button');

            if (ctaButton) {
                ctaButton.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-2px) scale(1.02)';
                });

                ctaButton.addEventListener('mouseleave', function() {
                    this.style.transform = '';
                });
            }
        }

        // Responsive Image Loading
        function initResponsiveImages() {
            const images = document.querySelectorAll('img[data-src]');

            const imageObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        img.src = img.dataset.src;
                        img.classList.remove('lazy');
                        imageObserver.unobserve(img);
                    }
                });
            });

            images.forEach(img => imageObserver.observe(img));
        }

        // Touch Device Optimizations
        function initTouchOptimizations() {
            // Add touch class for CSS targeting
            if ('ontouchstart' in window) {
                document.documentElement.classList.add('touch-device');
            }

            // Improve tap targets on mobile
            const isMobile = window.innerWidth < 768;
            if (isMobile) {
                const buttons = document.querySelectorAll('.btn, a[role="button"]');
                buttons.forEach(btn => {
                    btn.style.minHeight = '44px';
                    btn.style.minWidth = '44px';
                });
            }
        }

        // Initialize all features
        function initFooterFeatures() {
            // animateCounters();
            initBackToTop();
            initNewsletterForm();
            initSocialLinks();
            initCTAButton();
        }

        function initGlobalFeatures() {
            initMobileMenu();
            initResponsiveImages();
            initTouchOptimizations();
        }

        // Call initialization when DOM is loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                initFooterFeatures();
                initGlobalFeatures();
            });
        } else {
            initFooterFeatures();
            initGlobalFeatures();
        }
    });
</script>

<!-- FOOTER -->
{% block footer %}
<footer class="footer">
    <div class="container">
        <div class="footer-content">
            <!-- Company Info -->
            <div class="footer-section">
                <div class="footer-logo">
                    <i class="fas fa-leaf"></i>
                    <span>MedShare</span>
                </div>
                <p class="footer-description">
                    A comprehensive medicine donation platform connecting donors with NGOs and hospitals.
                    Help save lives by donating unused medicines and supporting healthcare initiatives.
                </p>
                <div class="social-links">
                    <a href="#" class="social-link" title="Facebook">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="#" class="social-link" title="Twitter">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="#" class="social-link" title="Instagram">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a href="#" class="social-link" title="LinkedIn">
                        <i class="fab fa-linkedin-in"></i>
                    </a>
                </div>
            </div>

            <!-- Quick Links -->
            <div class="footer-section">
                <h4>Quick Links</h4>
                <ul class="footer-links">
                    <li><a href="{% url 'home' %}">Home</a></li>
                    <li><a href="{% url 'search_medicines' %}">Find Medicines</a></li>
                    <li><a href="{% url 'medicines_map' %}">Medicines Map</a></li>
                    <li><a href="{% url 'emergency_alerts' %}">Emergency Alerts</a></li>
                    <li><a href="{% url 'faq' %}">FAQ</a></li>
                </ul>
            </div>

            <!-- For Donors -->
            <div class="footer-section">
                <h4>For Donors</h4>
                <ul class="footer-links">
                    {% if user.is_authenticated and user.profile.role == "donor" %}
                        <li><a href="{% url 'add_medicine' %}">Donate Medicine</a></li>
                        <li><a href="{% url 'donor_dashboard' %}">My Donations</a></li>
                    {% else %}
                        <li><a href="{% url 'signup' %}">Become a Donor</a></li>
                    {% endif %}
                    <li><a href="{% url 'expiry_tracker' %}">Expiry Tracker</a></li>
                    <li><a href="{% url 'medicine_categories' %}">Medicine Categories</a></li>
                </ul>
            </div>

            <!-- For NGOs -->
            <div class="footer-section">
                <h4>For NGOs & Hospitals</h4>
                <ul class="footer-links">
                    {% if user.is_authenticated and user.profile.role in "ngo,individual" %}
                        <li><a href="{% url 'ngo_dashboard' %}">NGO Dashboard</a></li>
                        <li><a href="{% url 'bulk_requests' %}">Bulk Requests</a></li>
                    {% else %}
                        <li><a href="{% url 'signup' %}">Register NGO</a></li>
                    {% endif %}
                    <li><a href="{% url 'ngo_inventory' %}">Inventory Management</a></li>
                    <li><a href="{% url 'emergency_alerts' %}">Create Alerts</a></li>
                </ul>
            </div>

            <!-- Contact & Newsletter -->
            <div class="footer-section">
                <h4>Stay Connected</h4>
                <div class="newsletter-signup">
                    <p>Subscribe to our newsletter for updates on medicine donations and healthcare initiatives.</p>
                    <form class="newsletter-form">
                        <div class="input-group">
                            <input type="email" placeholder="Enter your email" required>
                            <button type="submit">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </form>
                </div>
                <div class="contact-info">
                    <div class="contact-item">
                        <i class="fas fa-envelope"></i>
                        <span>support@medshare.com</span>
                    </div>
                    <div class="contact-item">
                        <i class="fas fa-phone"></i>
                        <span>+1 (555) 123-4567</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer Bottom -->
        <div class="footer-bottom">
            <div class="footer-bottom-content">
                <p>&copy; 2026 MedShare. All rights reserved. Made with <i class="fas fa-heart text-danger"></i> for healthcare.</p>
                <div class="footer-bottom-links">
                    <a href="{% url 'about' %}">About Us</a>
                    <a href="{% url 'contact' %}">Contact</a>
                    <a href="{% url 'privacy' %}">Privacy Policy</a>
                    <a href="{% url 'terms' %}">Terms of Service</a>
                </div>
            </div>
        </div>
    </div>
</footer>
{% endblock %}

<!-- Back to Top Button -->
<button id="back-to-top" class="back-to-top-btn" title="Back to Top">
    <i class="fas fa-arrow-up"></i>
</button>

</body>
</html>
